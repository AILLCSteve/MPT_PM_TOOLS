# HOTDOG AI Visual Flowchart
**Hierarchical Orchestrated Thorough Document Oversight & Guidance**

This document provides visual flowcharts for understanding HOTDOG AI's architecture and data flow.

---

## System Overview Flowchart

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   USER UPLOADS PDF   â”‚
                    â”‚   (bid_spec.pdf)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘          LAYER 0: DOCUMENT INGESTION             â•‘
        â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
        â•‘  â”‚  PyMuPDF Extraction                         â”‚  â•‘
        â•‘  â”‚  â€¢ Extract text per page                    â”‚  â•‘
        â•‘  â”‚  â€¢ Preserve page numbers as metadata        â”‚  â•‘
        â•‘  â”‚  â€¢ Output: [(pg1, text1), (pg2, text2)...]  â”‚  â•‘
        â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘      LAYER 1: DYNAMIC CONFIGURATION LOADER        â•‘
        â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
        â•‘  â”‚  Load Question Config (JSON/DB)             â”‚  â•‘
        â•‘  â”‚  â€¢ Parse sections (N sections)              â”‚  â•‘
        â•‘  â”‚  â€¢ Parse questions (M questions)            â”‚  â•‘
        â•‘  â”‚  â€¢ Create section-question mappings         â”‚  â•‘
        â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘    LAYER 2: DYNAMIC EXPERT PERSONA GENERATION     â•‘
        â•‘                                                     â•‘
        â•‘  FOR EACH SECTION:                                 â•‘
        â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
        â•‘  â”‚  Check Cache                                 â”‚  â•‘
        â•‘  â”‚  â””â”€ Cache Hit? â†’ Return Cached Expert       â”‚  â•‘
        â•‘  â”‚  â””â”€ Cache Miss? â†“                           â”‚  â•‘
        â•‘  â”‚                                              â”‚  â•‘
        â•‘  â”‚  AI Persona Generator                        â”‚  â•‘
        â•‘  â”‚  Input: Section name + description          â”‚  â•‘
        â•‘  â”‚  Output: {expert_name, specialization,      â”‚  â•‘
        â•‘  â”‚           system_prompt, citation_strategy}  â”‚  â•‘
        â•‘  â”‚                                              â”‚  â•‘
        â•‘  â”‚  Cache Expert for Reuse                      â”‚  â•‘
        â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
        â•‘                                                     â•‘
        â•‘  Result: N Experts (one per section)               â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘         WINDOWED PROCESSING LOOP                   â•‘
        â•‘                                                     â•‘
        â•‘  FOR EACH 3-PAGE WINDOW:                           â•‘
        â•‘  â”‚                                                  â•‘
        â•‘  â”œâ”€â–º LAYER 5: TOKEN BUDGET CHECK                  â•‘
        â•‘  â”‚    â€¢ Calculate tokens available                 â•‘
        â•‘  â”‚    â€¢ Adjust context if needed                   â•‘
        â•‘  â”‚    â€¢ Prioritize unanswered questions            â•‘
        â•‘  â”‚                                                  â•‘
        â•‘  â”œâ”€â–º LAYER 3: MULTI-EXPERT PROCESSING             â•‘
        â•‘  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
        â•‘  â”‚    â”‚  Route Questions to Experts          â”‚    â•‘
        â•‘  â”‚    â”‚  Section 1 â†’ Expert 1               â”‚    â•‘
        â•‘  â”‚    â”‚  Section 2 â†’ Expert 2               â”‚    â•‘
        â•‘  â”‚    â”‚  ...                                 â”‚    â•‘
        â•‘  â”‚    â”‚  Section N â†’ Expert N               â”‚    â•‘
        â•‘  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
        â•‘  â”‚    â”‚                                           â•‘
        â•‘  â”‚    â”œâ”€â–º PARALLEL AI CALLS                      â•‘
        â•‘  â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
        â•‘  â”‚    â”‚   â”‚Expert 1â”‚ â”‚Expert 2â”‚ â”‚Expert Nâ”‚      â•‘
        â•‘  â”‚    â”‚   â”‚GPT-4   â”‚ â”‚GPT-4   â”‚ â”‚GPT-4   â”‚      â•‘
        â•‘  â”‚    â”‚   â”‚Call    â”‚ â”‚Call    â”‚ â”‚Call    â”‚      â•‘
        â•‘  â”‚    â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â•‘
        â•‘  â”‚    â”‚       â”‚          â”‚          â”‚            â•‘
        â•‘  â”‚    â”‚       â–¼          â–¼          â–¼            â•‘
        â•‘  â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
        â•‘  â”‚    â”‚   â”‚  Answers with Page Citationsâ”‚        â•‘
        â•‘  â”‚    â”‚   â”‚  {Q1: {ans, pages:[1,2,3]}} â”‚        â•‘
        â•‘  â”‚    â”‚   â”‚  {Q28: {ans, pages:[2,3]}}  â”‚        â•‘
        â•‘  â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
        â•‘  â”‚    â”‚                                           â•‘
        â•‘  â”‚    â””â”€â–º VALIDATE PAGE CITATIONS                â•‘
        â•‘  â”‚        â€¢ Every answer must have pages[]        â•‘
        â•‘  â”‚        â€¢ Every answer must have <PDF pg X>     â•‘
        â•‘  â”‚        â€¢ Reject if missing citations           â•‘
        â•‘  â”‚                                                 â•‘
        â•‘  â”œâ”€â–º LAYER 4: SMART ACCUMULATION                  â•‘
        â•‘  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
        â•‘  â”‚    â”‚  For Each New Answer:                â”‚    â•‘
        â•‘  â”‚    â”‚                                       â”‚    â•‘
        â•‘  â”‚    â”‚  Calculate Similarity with Existing   â”‚    â•‘
        â•‘  â”‚    â”‚  â””â”€ Similarity â‰¥ 80%?                â”‚    â•‘
        â•‘  â”‚    â”‚      YES â†’ MERGE:                     â”‚    â•‘
        â•‘  â”‚    â”‚        â€¢ Combine text (keep details)  â”‚    â•‘
        â•‘  â”‚    â”‚        â€¢ Aggregate pages: [1,2]+[5,6] â”‚    â•‘
        â•‘  â”‚    â”‚        â€¢ Update confidence            â”‚    â•‘
        â•‘  â”‚    â”‚      NO â†’ APPEND:                     â”‚    â•‘
        â•‘  â”‚    â”‚        â€¢ Add as separate answer       â”‚    â•‘
        â•‘  â”‚    â”‚        â€¢ Rank by confidence           â”‚    â•‘
        â•‘  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
        â•‘  â”‚                                                 â•‘
        â•‘  â”œâ”€â–º LAYER 6: UPDATE DISPLAY                      â•‘
        â•‘  â”‚    â€¢ Update browser unitary log table          â•‘
        â•‘  â”‚    â€¢ Show progress (pages processed)           â•‘
        â•‘  â”‚    â€¢ Display confidence badges                 â•‘
        â•‘  â”‚                                                 â•‘
        â•‘  â””â”€â–º NEXT WINDOW                                  â•‘
        â•‘                                                     â•‘
        â•‘  LOOP UNTIL ALL PAGES PROCESSED                    â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘         LAYER 6: FINAL COMPILATION                 â•‘
        â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
        â•‘  â”‚  Browser Display:                           â”‚  â•‘
        â•‘  â”‚  â€¢ Unitary log table (105 questions)        â”‚  â•‘
        â•‘  â”‚  â€¢ Highest-confidence answer per question   â”‚  â•‘
        â•‘  â”‚  â€¢ All PDF page citations visible           â”‚  â•‘
        â•‘  â”‚  â€¢ Confidence badges (ğŸŸ¢ğŸŸ¡ğŸ”´)              â”‚  â•‘
        â•‘  â”‚                                              â”‚  â•‘
        â•‘  â”‚  Excel Export:                               â”‚  â•‘
        â•‘  â”‚  â€¢ Sheet 1: Primary answers + citations     â”‚  â•‘
        â•‘  â”‚  â€¢ Sheet 2: All answer variants             â”‚  â•‘
        â•‘  â”‚  â€¢ Sheet 3: Metadata & statistics           â”‚  â•‘
        â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  USER DOWNLOADS      â”‚
                    â”‚  analysis.xlsx       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Layer 2: Expert Generation Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT: Section Object                                   â”‚
â”‚  {                                                        â”‚
â”‚    id: "materials",                                      â”‚
â”‚    name: "Materials & Equipment Specifications",        â”‚
â”‚    description: "Pipe materials, resins, liners...",    â”‚
â”‚    questions: [Q28, Q29, Q30, ...]                      â”‚
â”‚  }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Generate Cache Key        â”‚
        â”‚  hash("Materials & Equip") â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Check Expert Cache        â”‚
        â”‚  (Redis or in-memory)      â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚              â”‚
       Cache HIT      Cache MISS
             â”‚              â”‚
             â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Return   â”‚   â”‚  Call AI Persona Generator      â”‚
    â”‚   Cached   â”‚   â”‚                                  â”‚
    â”‚   Expert   â”‚   â”‚  Prompt:                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  "Design expert for Materials   â”‚
                     â”‚   & Equipment Specifications"    â”‚
                     â”‚                                  â”‚
                     â”‚  Sample questions provided       â”‚
                     â”‚                                  â”‚
                     â”‚  Output required:                â”‚
                     â”‚  - expert_name                   â”‚
                     â”‚  - specialization                â”‚
                     â”‚  - system_prompt                 â”‚
                     â”‚  - citation_strategy             â”‚
                     â”‚  - answer_format                 â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Parse AI Response (JSON)    â”‚
                     â”‚                               â”‚
                     â”‚  {                            â”‚
                     â”‚    "expert_name": "CIPP      â”‚
                     â”‚      Materials Specialist",   â”‚
                     â”‚    "system_prompt": "You are â”‚
                     â”‚      a materials engineer..." â”‚
                     â”‚    ...                        â”‚
                     â”‚  }                            â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Create Expert Object        â”‚
                     â”‚  Validate required fields    â”‚
                     â”‚  Add metadata                â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Store in Cache              â”‚
                     â”‚  TTL: 30 days                â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Return Expert Persona       â”‚
                     â”‚  Ready for processing        â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Layer 3: Window Processing Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WINDOW 5: Pages [13, 14, 15]                             â”‚
â”‚  Context text: ~6000 characters                          â”‚
â”‚  All 105 questions need answers                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 1: Token Budget Check        â”‚
        â”‚  â€¢ Estimate tokens needed          â”‚
        â”‚  â€¢ Adjust context if over budget   â”‚
        â”‚  â€¢ Prioritize unanswered questions â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 2: Route Questions           â”‚
        â”‚                                     â”‚
        â”‚  105 questions â†’ 9 sections         â”‚
        â”‚                                     â”‚
        â”‚  Section 1 (General): Q1-Q15       â”‚
        â”‚    â†’ GeneralProjectExpert          â”‚
        â”‚                                     â”‚
        â”‚  Section 3 (Materials): Q28-Q45    â”‚
        â”‚    â†’ MaterialsSpecialist           â”‚
        â”‚                                     â”‚
        â”‚  Section 6 (Safety): Q70-Q80       â”‚
        â”‚    â†’ SafetyComplianceOfficer       â”‚
        â”‚                                     â”‚
        â”‚  ... (all 9 sections routed)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 3: Build Expert Prompts                  â”‚
        â”‚                                                 â”‚
        â”‚  For MaterialsSpecialist:                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ SYSTEM: {expert.system_prompt}           â”‚ â”‚
        â”‚  â”‚ "You are a materials specialist..."      â”‚ â”‚
        â”‚  â”‚                                            â”‚ â”‚
        â”‚  â”‚ USER:                                      â”‚ â”‚
        â”‚  â”‚ "Analyzing pages 13-15                   â”‚ â”‚
        â”‚  â”‚                                            â”‚ â”‚
        â”‚  â”‚  CRITICAL: Include <PDF pg X> in ALL     â”‚ â”‚
        â”‚  â”‚  answers. Current pages: 13, 14, 15      â”‚ â”‚
        â”‚  â”‚                                            â”‚ â”‚
        â”‚  â”‚  Context:                                  â”‚ â”‚
        â”‚  â”‚  [TEXT FROM PAGES 13-15]                  â”‚ â”‚
        â”‚  â”‚                                            â”‚ â”‚
        â”‚  â”‚  Questions:                                â”‚ â”‚
        â”‚  â”‚  Q28. What resin type?                    â”‚ â”‚
        â”‚  â”‚  Q29. What ASTM standards?                â”‚ â”‚
        â”‚  â”‚  ...                                       â”‚ â”‚
        â”‚  â”‚                                            â”‚ â”‚
        â”‚  â”‚  Output JSON:                              â”‚ â”‚
        â”‚  â”‚  {Q28: {answer, confidence, pages}}       â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 4: PARALLEL AI EXECUTION                   â”‚
        â”‚                                                   â”‚
        â”‚  async def process_all_experts():                â”‚
        â”‚      tasks = [                                    â”‚
        â”‚          call_expert(GeneralProjectExpert),      â”‚
        â”‚          call_expert(MaterialsSpecialist),       â”‚
        â”‚          call_expert(SafetyOfficer),             â”‚
        â”‚          ... (all 9 experts)                     â”‚
        â”‚      ]                                            â”‚
        â”‚      results = await gather(*tasks)              â”‚
        â”‚                                                   â”‚
        â”‚  All 9 API calls execute simultaneously          â”‚
        â”‚  Typical latency: 3-5 seconds                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 5: Parse & Validate Responses              â”‚
        â”‚                                                   â”‚
        â”‚  MaterialsSpecialist response:                   â”‚
        â”‚  {                                                â”‚
        â”‚    "Q28": {                                      â”‚
        â”‚      "answer": "Vinyl ester resin per ASTM      â”‚
        â”‚                 F1216 <PDF pg 13>",             â”‚
        â”‚      "confidence": 0.90,                         â”‚
        â”‚      "pages": [13]                              â”‚
        â”‚    },                                            â”‚
        â”‚    "Q29": {                                      â”‚
        â”‚      "answer": "ASTM F1216, F1743, D5813        â”‚
        â”‚                 <PDF pg 13, 14>",               â”‚
        â”‚      "confidence": 0.95,                         â”‚
        â”‚      "pages": [13, 14]                          â”‚
        â”‚    }                                             â”‚
        â”‚  }                                                â”‚
        â”‚                                                   â”‚
        â”‚  VALIDATION:                                      â”‚
        â”‚  âœ… Check "answer" field exists                  â”‚
        â”‚  âœ… Check "pages" array present & non-empty      â”‚
        â”‚  âœ… Check pages are in window [13,14,15]         â”‚
        â”‚  âœ… Check answer contains "<PDF pg X>"           â”‚
        â”‚  âŒ REJECT if any validation fails               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 6: Merge All Expert Results                â”‚
        â”‚                                                   â”‚
        â”‚  Combine answers from all 9 experts:             â”‚
        â”‚  {                                                â”‚
        â”‚    "Q1": {...},  â† from GeneralProjectExpert    â”‚
        â”‚    "Q2": {...},  â† from GeneralProjectExpert    â”‚
        â”‚    ...                                            â”‚
        â”‚    "Q28": {...}, â† from MaterialsSpecialist     â”‚
        â”‚    "Q29": {...}, â† from MaterialsSpecialist     â”‚
        â”‚    ...                                            â”‚
        â”‚    "Q70": {...}, â† from SafetyOfficer           â”‚
        â”‚    ...                                            â”‚
        â”‚    "Q105": {...} â† from LegalComplianceExpert   â”‚
        â”‚  }                                                â”‚
        â”‚                                                   â”‚
        â”‚  Total: ~105 answers with page citations         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  OUTPUT: Window Results                           â”‚
        â”‚  {                                                â”‚
        â”‚    window_num: 5,                                â”‚
        â”‚    pages: [13, 14, 15],                          â”‚
        â”‚    answers: {Q1: {...}, Q28: {...}, ...},       â”‚
        â”‚    tokens_used: 8234,                            â”‚
        â”‚    processing_time: 4.2s                         â”‚
        â”‚  }                                                â”‚
        â”‚                                                   â”‚
        â”‚  â†’ Pass to Layer 4 (Accumulation)                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Layer 4: Smart Deduplication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NEW ANSWER from Window 5:                                â”‚
â”‚  Q28: "Vinyl ester resin per ASTM F1216 <PDF pg 13, 14>" â”‚
â”‚  pages: [13, 14]                                          â”‚
â”‚  confidence: 0.92                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Check Existing Answers for Q28    â”‚
        â”‚                                     â”‚
        â”‚  Found 1 existing:                  â”‚
        â”‚  "Vinyl ester resin required       â”‚
        â”‚   <PDF pg 3>"                      â”‚
        â”‚  pages: [3]                         â”‚
        â”‚  confidence: 0.75                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Calculate Semantic Similarity     â”‚
        â”‚                                     â”‚
        â”‚  Method: Embedding + Cosine        â”‚
        â”‚                                     â”‚
        â”‚  existing: "Vinyl ester resin      â”‚
        â”‚             required"               â”‚
        â”‚  new:      "Vinyl ester resin per  â”‚
        â”‚             ASTM F1216"             â”‚
        â”‚                                     â”‚
        â”‚  Similarity: 0.87 (87%)            â”‚
        â”‚  Threshold: 0.80 (80%)             â”‚
        â”‚                                     â”‚
        â”‚  Result: SIMILAR â†’ MERGE           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Information Merge Strategy                   â”‚
        â”‚                                                â”‚
        â”‚  Compare specificity:                         â”‚
        â”‚  â€¢ Existing: "required" (vague)              â”‚
        â”‚  â€¢ New: "per ASTM F1216" (specific standard) â”‚
        â”‚                                                â”‚
        â”‚  Decision: Use new as base (more specific)   â”‚
        â”‚                                                â”‚
        â”‚  Extract unique from existing: "required"    â”‚
        â”‚  Add to new answer                            â”‚
        â”‚                                                â”‚
        â”‚  Merged text:                                 â”‚
        â”‚  "Vinyl ester resin per ASTM F1216 required" â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Aggregate Page Citations                     â”‚
        â”‚                                                â”‚
        â”‚  Existing pages: [3]                          â”‚
        â”‚  New pages: [13, 14]                          â”‚
        â”‚                                                â”‚
        â”‚  Merge: [3] + [13, 14] = [3, 13, 14]        â”‚
        â”‚  Remove duplicates: N/A                       â”‚
        â”‚  Sort ascending: [3, 13, 14]                 â”‚
        â”‚                                                â”‚
        â”‚  Update citation in text:                     â”‚
        â”‚  "<PDF pg 3, 13, 14>"                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Update Confidence                            â”‚
        â”‚                                                â”‚
        â”‚  Existing: 0.75                               â”‚
        â”‚  New: 0.92                                    â”‚
        â”‚                                                â”‚
        â”‚  Strategy: Use HIGHEST (more specific)       â”‚
        â”‚  Updated: 0.92                                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Update Accumulated Answer (in-place)        â”‚
        â”‚                                                â”‚
        â”‚  accumulated_answers["Q28"] = [{              â”‚
        â”‚    answer: "Vinyl ester resin per ASTM       â”‚
        â”‚             F1216 required <PDF pg 3,13,14>",â”‚
        â”‚    pages: [3, 13, 14],                       â”‚
        â”‚    confidence: 0.92,                          â”‚
        â”‚    windows: [1, 5],                          â”‚
        â”‚    expert: "MaterialsSpecialist",            â”‚
        â”‚    merge_count: 1,                           â”‚
        â”‚    last_updated: "2025-11-29 14:23:15"       â”‚
        â”‚  }]                                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
                DONE


ALTERNATIVE PATH: If Similarity < 0.80
===================================

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Similarity < 0.80                 â”‚
        â”‚  â†’ DISTINCT Information            â”‚
        â”‚  â†’ APPEND as separate answer       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Add as New Answer Variant                    â”‚
        â”‚                                                â”‚
        â”‚  accumulated_answers["Q28"] = [               â”‚
        â”‚    {                                          â”‚
        â”‚      answer: "Vinyl ester resin required     â”‚
        â”‚               <PDF pg 3>",                   â”‚
        â”‚      pages: [3],                              â”‚
        â”‚      confidence: 0.75                         â”‚
        â”‚    },                                         â”‚
        â”‚    {  â† NEW ANSWER ADDED                     â”‚
        â”‚      answer: "Resin shall cure at 180Â°F     â”‚
        â”‚               <PDF pg 13, 14>",              â”‚
        â”‚      pages: [13, 14],                         â”‚
        â”‚      confidence: 0.92                         â”‚
        â”‚    }                                          â”‚
        â”‚  ]                                            â”‚
        â”‚                                                â”‚
        â”‚  Sort by confidence (highest first)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Document Processing Timeline

```
TIME â†’

t=0s    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  User Uploads PDF    â”‚
        â”‚  (50 pages)          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=2s               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Layer 0: Extract    â”‚
        â”‚  50 pages with text  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=3s               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Layer 1: Load       â”‚
        â”‚  105 questions,      â”‚
        â”‚  9 sections          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=5s               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Layer 2: Generate   â”‚
        â”‚  9 expert personas   â”‚
        â”‚  (or use cache)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=10s              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  START WINDOWED PROCESSING           â”‚
        â”‚                                       â”‚
        â”‚  Window 1 (pages 1-3):               â”‚
        â”‚  â”œâ”€ Token check: âœ…                  â”‚
        â”‚  â”œâ”€ 9 experts Ã— parallel calls       â”‚
        â”‚  â”œâ”€ Parse responses                   â”‚
        â”‚  â”œâ”€ Accumulate (first answers)       â”‚
        â”‚  â””â”€ Display update                    â”‚
        â”‚  Time: 5 seconds                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=15s              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Window 2 (pages 4-6):               â”‚
        â”‚  â”œâ”€ Token check: âœ…                  â”‚
        â”‚  â”œâ”€ 9 experts Ã— parallel calls       â”‚
        â”‚  â”œâ”€ Parse responses                   â”‚
        â”‚  â”œâ”€ Smart deduplication (merge)      â”‚
        â”‚  â””â”€ Display update                    â”‚
        â”‚  Time: 5 seconds                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Windows 3-16 process...             â”‚
        â”‚  Each window: ~5 seconds             â”‚
        â”‚  (some variation based on content)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=90s              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Window 17 (pages 49-50):            â”‚
        â”‚  â”œâ”€ Token check: âœ…                  â”‚
        â”‚  â”œâ”€ 9 experts Ã— parallel calls       â”‚
        â”‚  â”œâ”€ Parse responses                   â”‚
        â”‚  â”œâ”€ Final accumulation               â”‚
        â”‚  â””â”€ Display update                    â”‚
        â”‚  Time: 5 seconds                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=95s              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Layer 6: Final Compilation          â”‚
        â”‚  â€¢ All 105 questions answered âœ…     â”‚
        â”‚  â€¢ All 50 pages processed âœ…         â”‚
        â”‚  â€¢ All citations aggregated âœ…       â”‚
        â”‚  â€¢ Export ready âœ…                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=97s              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Display Complete    â”‚
        â”‚  Unitary Log         â”‚
        â”‚                       â”‚
        â”‚  User clicks         â”‚
        â”‚  "Export to Excel"   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
t=100s             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Download Excel      â”‚
        â”‚  with 3 sheets       â”‚
        â”‚  âœ… COMPLETE         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL TIME: ~100 seconds (1 min 40 sec) for 50-page document
```

---

## Data Structure Evolution

```
WINDOW 1 (Pages 1-3):
===================================
accumulated_answers = {
  "Q1": [{
    answer: "XYZ Sewer Project <PDF pg 1>",
    pages: [1],
    confidence: 0.95,
    windows: [1]
  }],
  "Q28": [{
    answer: "Vinyl ester resin required <PDF pg 3>",
    pages: [3],
    confidence: 0.75,
    windows: [1]
  }],
  ... (105 questions)
}


WINDOW 5 (Pages 13-15):
===================================
accumulated_answers = {
  "Q1": [{
    answer: "XYZ Sewer Project <PDF pg 1, 3, 5>",  â† MERGED
    pages: [1, 3, 5],                               â† AGGREGATED
    confidence: 0.95,
    windows: [1, 2, 5]
  }],
  "Q28": [{
    answer: "Vinyl ester resin per ASTM F1216      â† MERGED
             required <PDF pg 3, 13, 14>",
    pages: [3, 13, 14],                             â† AGGREGATED
    confidence: 0.92,                               â† UPDATED
    windows: [1, 5],
    merge_count: 1
  }],
  ... (105 questions, some with multiple answers)
}


WINDOW 10 (Pages 28-30):
===================================
accumulated_answers = {
  "Q28": [
    {  â† Primary answer (highest confidence)
      answer: "Vinyl ester resin per ASTM F1216
               required <PDF pg 3, 13, 14>",
      pages: [3, 13, 14],
      confidence: 0.92,
      windows: [1, 5]
    },
    {  â† Secondary answer (distinct information)
      answer: "Resin shall cure at minimum 180Â°F
               <PDF pg 28, 29>",
      pages: [28, 29],
      confidence: 0.85,
      windows: [10]
    }
  ],
  ... (all questions with accumulated answers)
}


WINDOW 17 (Pages 49-50) - FINAL:
===================================
accumulated_answers = {
  "Q28": [
    {
      answer: "Vinyl ester resin per ASTM F1216
               required <PDF pg 3, 13, 14, 45>",
      pages: [3, 13, 14, 45],                    â† ALL PAGES
      confidence: 0.92,
      windows: [1, 5, 15]                        â† ALL WINDOWS
    },
    {
      answer: "Resin shall cure at minimum 180Â°F
               <PDF pg 28, 29, 47>",
      pages: [28, 29, 47],                       â† ALL PAGES
      confidence: 0.87,                           â† UPDATED
      windows: [10, 16]                          â† ALL WINDOWS
    },
    {
      answer: "Minimum wall thickness after
               curing: 6mm <PDF pg 49>",
      pages: [49],
      confidence: 0.88,
      windows: [17]
    }
  ],
  ... (all 105 questions fully accumulated)
}
```

---

## SOLID Principles Applied to HOTDOG AI

### Single Responsibility Principle (SRP)

```
DocumentIngestionService
â””â”€ Responsibility: Extract text from PDFs with page numbers
   â””â”€ NOT responsible for: Question routing, AI calls, display

ConfigurationLoader
â””â”€ Responsibility: Load and parse question configurations
   â””â”€ NOT responsible for: PDF extraction, expert generation

ExpertPersonaGenerator
â””â”€ Responsibility: Generate or retrieve expert personas
   â””â”€ NOT responsible for: Answering questions, merging answers

MultiExpertProcessor
â””â”€ Responsibility: Execute parallel expert AI calls
   â””â”€ NOT responsible for: Deduplication, display, export

SmartAccumulator
â””â”€ Responsibility: Merge and deduplicate answers
   â””â”€ NOT responsible for: AI calls, page extraction, display
```

### Open/Closed Principle (OCP)

```
ExpertPersona (Base Class)
â”œâ”€ Open for extension: New expert types can be added
â””â”€ Closed for modification: Base interface doesn't change

Question Configuration
â”œâ”€ Open for extension: New question sets via JSON
â””â”€ Closed for modification: Parser doesn't change

Answer Accumulation Strategy
â”œâ”€ Open for extension: New merge strategies
â””â”€ Closed for modification: Core interface stable
```

### Dependency Inversion Principle (DIP)

```
HIGH-LEVEL: HotdogOrchestrator
  â†“ depends on â†“
ABSTRACTION: DocumentExtractorInterface
  â†‘ implemented by â†‘
LOW-LEVEL: PyMuPDFExtractor, DocxExtractor, etc.

HIGH-LEVEL: LayerThreeProcessor
  â†“ depends on â†“
ABSTRACTION: ExpertPersonaInterface
  â†‘ implemented by â†‘
LOW-LEVEL: MaterialsExpert, SafetyExpert, etc.
```

---

## Key Takeaways

1. **User-Centric Design**: Every layer serves the purpose of accurate, exhaustive document analysis

2. **Dynamic Flexibility**: Questions, sections, and experts adapt to each analysis

3. **Page Number Integrity**: Citations are mandatory metadata at every stage, never optional

4. **Smart Deduplication**: Preserves all information while merging similar answers

5. **Token Efficiency**: Intelligent budget management ensures exhaustive coverage

6. **SOLID Architecture**: Clean separation of concerns, easy to extend and maintain

7. **Parallel Processing**: 9 experts execute simultaneously for speed

8. **Comprehensive Output**: Browser display + multi-sheet Excel export with full metadata

**HOTDOG AI is purpose-built for this application, not adapted from another system.**
