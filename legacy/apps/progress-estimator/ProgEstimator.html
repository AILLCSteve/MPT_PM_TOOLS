<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sewer Jetting Production Estimator</title>
    <style>
/* Sewer Jetting Production Estimator - Styles */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f5f6fa;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

header {
    text-align: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #2c3e50, #3498db);
    color: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    font-weight: 700;
}

header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

main {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.input-section, .results-section {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.education-section {
    grid-column: 1 / -1;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

h2 {
    color: #2c3e50;
    font-size: 1.8rem;
    margin-bottom: 20px;
    border-bottom: 3px solid #3498db;
    padding-bottom: 10px;
}

h3 {
    color: #34495e;
    font-size: 1.4rem;
    margin: 20px 0 15px 0;
}

h4 {
    color: #34495e;
    font-size: 1.2rem;
    margin: 15px 0 10px 0;
}

h5 {
    color: #7f8c8d;
    font-size: 1rem;
    margin: 10px 0 8px 0;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.input-group {
    margin-bottom: 20px;
}

.input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c3e50;
}

.slider-container {
    display: flex;
    align-items: center;
    gap: 15px;
}

.slider {
    flex: 1;
    height: 6px;
    border-radius: 3px;
    background: #ddd;
    outline: none;
    transition: background 0.3s;
}

.slider::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #3498db;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #3498db;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.number-input {
    width: 80px;
    padding: 8px 12px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    text-align: center;
    transition: border-color 0.3s;
}

.number-input:focus {
    outline: none;
    border-color: #3498db;
}

input[type="number"] {
    width: 150px;
    padding: 12px 15px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    transition: border-color 0.3s;
}

input[type="number"]:focus {
    outline: none;
    border-color: #3498db;
}

input[type="number"]::placeholder {
    color: #bdc3c7;
    font-style: italic;
}

.unit {
    font-weight: 600;
    color: #7f8c8d;
    min-width: 30px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: color 0.3s;
}

.checkbox-label:hover {
    color: #3498db;
}

input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #3498db;
}

.recycler-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    border: 2px solid #e9ecef;
    margin-top: 15px;
}

.pipe-diameter-section {
    margin-top: 10px;
}

.diameter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 8px;
    margin-top: 10px;
}

.realization-factors {
    margin-top: 20px;
}

.factors-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin: 15px 0;
}

.helps-section, .hurts-section {
    padding: 15px;
    border-radius: 8px;
}

.helps-section {
    background: #d5f4e6;
    border-left: 4px solid #27ae60;
}

.hurts-section {
    background: #fadbd8;
    border-left: 4px solid #e74c3c;
}

.f-value-display {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 20px;
    padding: 15px;
    background: #e8f4f8;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.f-value-display strong {
    color: #2c3e50;
    font-size: 1.1rem;
}

.comparison-table {
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

th {
    background: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
}

tr:nth-child(even) {
    background: #f8f9fa;
}

.recycler-row {
    background: #e8f4f8 !important;
    border-left: 4px solid #3498db;
}

.savings-display {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
}

.flags-container {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.flag-box {
    padding: 15px 20px;
    border-radius: 8px;
    border-left: 4px solid;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.flag-box h4 {
    margin: 0 0 8px 0;
    font-size: 1.1rem;
}

.flag-box p {
    margin: 0;
    font-size: 0.95rem;
}

.warning-flag {
    background: #fff3cd;
    border-left-color: #ffc107;
    color: #856404;
}

.suggestion-flag {
    background: #d1ecf1;
    border-left-color: #17a2b8;
    color: #0c5460;
}

.danger-flag {
    background: #f8d7da;
    border-left-color: #dc3545;
    color: #721c24;
}

.savings-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px 25px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 2px solid #e9ecef;
}

.savings-item .label {
    font-size: 0.9rem;
    color: #7f8c8d;
    margin-bottom: 5px;
    font-weight: 600;
}

.savings-item .value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c3e50;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.info-card {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.info-card h3 {
    color: #2c3e50;
    margin-bottom: 15px;
}

.info-card p {
    margin-bottom: 10px;
}

.info-card code {
    background: #e9ecef;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.tooltip {
    position: absolute;
    background: #2c3e50;
    color: white;
    padding: 8px 12px;
    border-radius: 5px;
    font-size: 0.9rem;
    max-width: 250px;
    z-index: 1000;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.tooltip::before {
    content: '';
    position: absolute;
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-bottom: 5px solid #2c3e50;
}

/* Responsive Design */
@media (max-width: 768px) {
    main {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .factors-grid {
        grid-template-columns: 1fr;
    }
    
    .slider-container {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }
    
    .f-value-display {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }
    
    .savings-display {
        flex-direction: column;
    }
    
    header h1 {
        font-size: 2rem;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 15px;
    }
    
    .input-section, .results-section, .education-section {
        padding: 20px;
    }
    
    header h1 {
        font-size: 1.8rem;
    }
    
    h2 {
        font-size: 1.5rem;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sewer Jetting Production Estimator</h1>
            <p>Calculate daily footage cleaned/TVed with recycler boost analysis</p>
        </header>

        <main>
            <div class="input-section">
                <h2>Project Parameters</h2>
                
                <div class="input-group">
                    <label for="totalFootage">Total Footage:</label>
                    <input type="number" id="totalFootage" placeholder="198,000" min="0">
                    <span class="unit">ft</span>
                </div>

                <div class="input-group">
                    <label for="baseRate">Base Production Rate:</label>
                    <div class="slider-container">
                        <input type="range" id="baseRateSlider" min="2000" max="5000" step="50" value="3100" class="slider">
                        <input type="number" id="baseRate" min="2000" max="5000" step="50" value="3100" class="number-input">
                        <span class="unit">ft/day</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>Pipe Diameters (inches):</label>
                    <div class="pipe-diameter-section">
                        <div class="diameter-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="6" data-penalty="0.3" data-heavy-multiplier="1.0" data-easement-multiplier="1.0">
                                6" (penalty: -30%)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="8" data-penalty="0" data-heavy-multiplier="1.0" data-easement-multiplier="1.0">
                                8" (base rate)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="10" data-penalty="0" data-heavy-multiplier="1.0" data-easement-multiplier="1.0">
                                10" (base rate)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="12" data-penalty="0" data-heavy-multiplier="1.0" data-easement-multiplier="1.0">
                                12" (base rate)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="15" data-penalty="0.2" data-heavy-multiplier="1.25" data-easement-multiplier="1.25">
                                15" (penalty: -20%, +25% heavy/easement)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="18" data-penalty="0.2" data-heavy-multiplier="1.5" data-easement-multiplier="1.5">
                                18" (penalty: -20%, +50% heavy/easement)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="21" data-penalty="0.4" data-heavy-multiplier="1.5" data-easement-multiplier="1.5">
                                21" (penalty: -40%, +50% heavy/easement)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="24" data-penalty="0.4" data-heavy-multiplier="1.5" data-easement-multiplier="1.5">
                                24" (penalty: -40%, +50% heavy/easement)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="36" data-penalty="0.4" data-heavy-multiplier="1.5" data-easement-multiplier="1.5">
                                36" (penalty: -40%, +50% heavy/easement)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="48" data-penalty="0.4" data-heavy-multiplier="1.5" data-easement-multiplier="1.5">
                                48" (penalty: -40%, +50% heavy/easement)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="pipe-diameter" data-diameter="large" data-penalty="0.4" data-heavy-multiplier="1.5" data-easement-multiplier="1.5">
                                LARGE (penalty: -40%, +50% heavy/easement)
                            </label>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="heavyPercentage">Heavy Cleaning Percentage:</label>
                    <div class="slider-container">
                        <input type="range" id="heavySlider" min="0" max="100" value="0" class="slider">
                        <input type="number" id="heavyPercentage" min="0" max="100" value="0" class="number-input">
                        <span class="unit">%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="easementPercentage">Easement Percentage:</label>
                    <div class="slider-container">
                        <input type="range" id="easementSlider" min="0" max="100" value="0" class="slider">
                        <input type="number" id="easementPercentage" min="0" max="100" value="0" class="number-input">
                        <span class="unit">%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="targetDays">Timetable for Completion:</label>
                    <input type="number" id="targetDays" placeholder="30" min="1">
                    <span class="unit">days</span>
                </div>

                <div class="input-group">
                    <label for="crewCount">Number of Crews:</label>
                    <input type="number" id="crewCount" min="1" max="10" value="1">
                    <span class="unit">crews</span>
                </div>

                <div class="input-group">
                    <label for="hoursPerDay">Hours per Work Day:</label>
                    <input type="number" id="hoursPerDay" min="4" max="16" value="8" step="0.5">
                    <span class="unit">hours</span>
                </div>

                <div class="input-group">
                    <label for="daysPerWeek">Days per Work Week:</label>
                    <input type="number" id="daysPerWeek" min="1" max="7" value="5">
                    <span class="unit">days</span>
                </div>

                <div class="input-group">
                    <label for="laborBudget">Labor Hours Budgeted:</label>
                    <input type="number" id="laborBudget" placeholder="640" min="0">
                    <span class="unit">hours</span>
                </div>

                <div class="input-group">
                    <label for="laborOverageAllowed">Labor Hours Overage Allowed:</label>
                    <div class="slider-container">
                        <input type="range" id="laborOverageSlider" min="0" max="50" value="10" class="slider">
                        <input type="number" id="laborOverageAllowed" min="0" max="50" value="10" class="number-input">
                        <span class="unit">%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="recyclerEnabled">
                        Use Recycler
                    </label>
                </div>

                <div id="recyclerSection" class="recycler-section" style="display: none;">
                    <h3>Recycler Configuration</h3>

                    <div class="input-group">
                        <label for="boostRange">Boost Range (B):</label>
                        <div class="slider-container">
                            <input type="range" id="boostSlider" min="0.30" max="0.70" step="0.01" value="0.50" class="slider">
                            <input type="number" id="boostRange" min="0.30" max="0.70" step="0.01" value="0.50" class="number-input">
                        </div>
                    </div>

                    <div class="realization-factors">
                        <h4>Realization Factor (F)</h4>
                        <p>Base F = 0.50</p>

                        <div class="factors-grid">
                            <div class="helps-section">
                                <h5>Helps (+0.10 each)</h5>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="help-factor" data-tooltip="Having charge lines available improves efficiency">
                                    Charge lines available
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="help-factor" data-tooltip="Clustered segments reduce travel time">
                                    Clustered segments
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="help-factor" data-tooltip="Limited hydrants mean more water recycling benefits">
                                    Hydrant scarcity
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="help-factor" data-tooltip="Good decant point improves water management">
                                    Reliable decant point
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="help-factor" data-tooltip="Experienced crew maximizes recycler benefits">
                                    Experienced crew
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="help-factor" data-tooltip="Moderate debris allows better water recycling">
                                    Moderate debris
                                </label>
                            </div>

                            <div class="hurts-section">
                                <h5>Hurts (-0.10 each)</h5>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="hurt-factor" data-tooltip="Scattered segments increase travel time">
                                    Scattered segments
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="hurt-factor" data-tooltip="Many hydrants reduce recycler necessity">
                                    Plentiful hydrants
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="hurt-factor" data-tooltip="Poor decant access hampers water management">
                                    Poor decant access
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="hurt-factor" data-tooltip="Heavy contamination reduces recycling efficiency">
                                    Heavy rags/grease
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="hurt-factor" data-tooltip="Difficult terrain slows operations">
                                    Steep/soft access
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" class="hurt-factor" data-tooltip="New crew needs time to optimize recycler use">
                                    New crew
                                </label>
                            </div>
                        </div>

                        <div class="f-value-display">
                            <span>Calculated F: <strong id="calculatedF">0.50</strong></span>
                            <label class="checkbox-label">
                                <input type="checkbox" id="manualF">
                                Manual Override:
                            </label>
                            <input type="number" id="manualFValue" min="0" max="1" step="0.01" value="0.50" disabled class="number-input">
                        </div>
                    </div>
                </div>
            </div>

            <div class="results-section">
                <h2>Results</h2>
                
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Production Rate (ft/day)</th>
                                <th>Total Days</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Without Recycler</td>
                                <td id="prodRateWithout">-</td>
                                <td id="daysWithout">-</td>
                            </tr>
                            <tr class="recycler-row">
                                <td>With Recycler</td>
                                <td id="prodRateWith">-</td>
                                <td id="daysWith">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="savings-display">
                    <div class="savings-item">
                        <span class="label">Time Savings:</span>
                        <span id="timeSavings" class="value">-</span>
                    </div>
                </div>

                <div class="flags-container">
                    <div id="scheduleOverrunFlag" class="flag-box warning-flag" style="display: none;">
                        <h4>‚ö†Ô∏è Schedule Overrun Warning</h4>
                        <p id="scheduleOverrunText"></p>
                    </div>

                    <div id="laborOverrunFlag" class="flag-box warning-flag" style="display: none;">
                        <h4>‚ö†Ô∏è Labor Hours Overrun Warning</h4>
                        <p id="laborOverrunText"></p>
                    </div>

                    <div id="recyclerSuggestionFlag" class="flag-box suggestion-flag" style="display: none;">
                        <h4>üí° Recycler Suggestion</h4>
                        <p id="recyclerSuggestionText"></p>
                    </div>

                    <div id="highRiskFlag" class="flag-box danger-flag" style="display: none;">
                        <h4>‚ö†Ô∏è High Risk Project</h4>
                        <p>This project involves large diameter pipes (>18") and is extremely risky. Requires experienced crew with specialized equipment.</p>
                    </div>
                </div>
            </div>

            <div class="education-section">
                <h2>How It Works</h2>
                
                <div class="info-grid">
                    <div class="info-card">
                        <h3>Base Model</h3>
                        <p>Adjustable base production rate: <strong>2,000-5,000 ft/day</strong></p>
                        <p>Heavy cleaning reduces efficiency by 40% of the percentage</p>
                        <p>Easement work reduces efficiency by 30% of the percentage</p>
                    </div>

                    <div class="info-card">
                        <h3>Recycler Boost</h3>
                        <p>Water recycling improves logistics and reduces downtime</p>
                        <p><strong>Boost (B):</strong> Technical efficiency gain (0.30-0.70)</p>
                        <p><strong>Realization Factor (F):</strong> Site-specific conditions (0-1.0)</p>
                    </div>

                    <div class="info-card">
                        <h3>Calculation Formula</h3>
                        <p><code>Effective ft/day = BaseRate √ó (1 - Heavy% √ó 0.40) √ó (1 - Easement% √ó 0.30) √ó (1 - PipePenalty) √ó CrewCount √ó (1 + RecyclerUse √ó B √ó F)</code></p>
                        <p><code>Work Days = Total footage / Effective ft/day</code></p>
                        <p><code>Labor Hours = Work Days √ó Hours/Day √ó Crew Count</code></p>
                        <p><strong>Enhanced:</strong> Multi-crew scaling, work schedule customization, intelligent suggestions</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
// Sewer Jetting Production Estimator - JavaScript Logic

class ProductionCalculator {
    constructor() {
        this.heavyPenalty = 0.40;   // 40% reduction for heavy cleaning
        this.easementPenalty = 0.30; // 30% reduction for easement work
        this.baseFactor = 0.50;     // Base realization factor

        this.initializeElements();
        this.bindEvents();
        this.calculate();
    }

    initializeElements() {
        // Input elements
        this.totalFootage = document.getElementById('totalFootage');
        this.baseRateSlider = document.getElementById('baseRateSlider');
        this.baseRate = document.getElementById('baseRate');
        this.pipeDiameters = document.querySelectorAll('.pipe-diameter');
        this.heavySlider = document.getElementById('heavySlider');
        this.heavyPercentage = document.getElementById('heavyPercentage');
        this.easementSlider = document.getElementById('easementSlider');
        this.easementPercentage = document.getElementById('easementPercentage');
        this.recyclerEnabled = document.getElementById('recyclerEnabled');
        this.recyclerSection = document.getElementById('recyclerSection');
        this.boostSlider = document.getElementById('boostSlider');
        this.boostRange = document.getElementById('boostRange');
        this.helpFactors = document.querySelectorAll('.help-factor');
        this.hurtFactors = document.querySelectorAll('.hurt-factor');
        this.calculatedF = document.getElementById('calculatedF');
        this.manualF = document.getElementById('manualF');
        this.manualFValue = document.getElementById('manualFValue');
        this.targetDays = document.getElementById('targetDays');
        this.crewCount = document.getElementById('crewCount');
        this.hoursPerDay = document.getElementById('hoursPerDay');
        this.daysPerWeek = document.getElementById('daysPerWeek');
        this.laborBudget = document.getElementById('laborBudget');
        this.laborOverageSlider = document.getElementById('laborOverageSlider');
        this.laborOverageAllowed = document.getElementById('laborOverageAllowed');

        // Output elements
        this.prodRateWithout = document.getElementById('prodRateWithout');
        this.daysWithout = document.getElementById('daysWithout');
        this.prodRateWith = document.getElementById('prodRateWith');
        this.daysWith = document.getElementById('daysWith');
        this.timeSavings = document.getElementById('timeSavings');
        this.recyclerRow = document.querySelector('.recycler-row');

        // Flag elements
        this.scheduleOverrunFlag = document.getElementById('scheduleOverrunFlag');
        this.scheduleOverrunText = document.getElementById('scheduleOverrunText');
        this.laborOverrunFlag = document.getElementById('laborOverrunFlag');
        this.laborOverrunText = document.getElementById('laborOverrunText');
        this.recyclerSuggestionFlag = document.getElementById('recyclerSuggestionFlag');
        this.recyclerSuggestionText = document.getElementById('recyclerSuggestionText');
        this.highRiskFlag = document.getElementById('highRiskFlag');
    }

    bindEvents() {
        // Base rate slider sync
        this.baseRateSlider.addEventListener('input', () => {
            this.baseRate.value = this.baseRateSlider.value;
            this.calculate();
        });

        this.baseRate.addEventListener('input', () => {
            this.baseRateSlider.value = this.baseRate.value;
            this.calculate();
        });

        // Pipe diameter checkboxes
        this.pipeDiameters.forEach(checkbox => {
            checkbox.addEventListener('change', () => this.calculate());
        });

        // Labor overage slider sync
        this.laborOverageSlider.addEventListener('input', () => {
            this.laborOverageAllowed.value = this.laborOverageSlider.value;
            this.calculate();
        });

        this.laborOverageAllowed.addEventListener('input', () => {
            this.laborOverageSlider.value = this.laborOverageAllowed.value;
            this.calculate();
        });

        // Additional parameter inputs
        this.targetDays.addEventListener('input', () => this.calculate());
        this.crewCount.addEventListener('input', () => this.calculate());
        this.hoursPerDay.addEventListener('input', () => this.calculate());
        this.daysPerWeek.addEventListener('input', () => this.calculate());
        this.laborBudget.addEventListener('input', () => this.calculate());

        // Sync sliders with number inputs
        this.heavySlider.addEventListener('input', () => {
            this.heavyPercentage.value = this.heavySlider.value;
            this.calculate();
        });

        this.heavyPercentage.addEventListener('input', () => {
            this.heavySlider.value = this.heavyPercentage.value;
            this.calculate();
        });

        this.easementSlider.addEventListener('input', () => {
            this.easementPercentage.value = this.easementSlider.value;
            this.calculate();
        });
        
        this.easementPercentage.addEventListener('input', () => {
            this.easementSlider.value = this.easementPercentage.value;
            this.calculate();
        });

        this.boostSlider.addEventListener('input', () => {
            this.boostRange.value = this.boostSlider.value;
            this.calculate();
        });
        
        this.boostRange.addEventListener('input', () => {
            this.boostSlider.value = this.boostRange.value;
            this.calculate();
        });

        // Recycler toggle
        this.recyclerEnabled.addEventListener('change', () => {
            this.recyclerSection.style.display = this.recyclerEnabled.checked ? 'block' : 'none';
            this.recyclerRow.style.display = this.recyclerEnabled.checked ? 'table-row' : 'none';
            this.calculate();
        });

        // Realization factor checkboxes
        this.helpFactors.forEach(checkbox => {
            checkbox.addEventListener('change', () => this.updateRealizationFactor());
        });
        
        this.hurtFactors.forEach(checkbox => {
            checkbox.addEventListener('change', () => this.updateRealizationFactor());
        });

        // Manual F override
        this.manualF.addEventListener('change', () => {
            this.manualFValue.disabled = !this.manualF.checked;
            this.calculate();
        });

        this.manualFValue.addEventListener('input', () => this.calculate());

        // Total footage input
        this.totalFootage.addEventListener('input', () => this.calculate());
    }

    updateRealizationFactor() {
        let f = this.baseFactor;
        
        // Add helps (+0.10 each)
        this.helpFactors.forEach(checkbox => {
            if (checkbox.checked) f += 0.10;
        });
        
        // Subtract hurts (-0.10 each)
        this.hurtFactors.forEach(checkbox => {
            if (checkbox.checked) f -= 0.10;
        });
        
        // Cap between 0 and 1
        f = Math.max(0, Math.min(1, f));
        
        this.calculatedF.textContent = f.toFixed(2);
        this.calculate();
    }

    getRealizationFactor() {
        if (this.manualF.checked) {
            return parseFloat(this.manualFValue.value) || 0.50;
        }
        return parseFloat(this.calculatedF.textContent) || 0.50;
    }

    getPipeDiameterInfo() {
        let maxPenalty = 0;
        let maxHeavyMultiplier = 1.0;
        let maxEasementMultiplier = 1.0;
        let hasLargePipes = false;

        this.pipeDiameters.forEach(checkbox => {
            if (checkbox.checked) {
                const diameter = checkbox.dataset.diameter;
                const penalty = parseFloat(checkbox.dataset.penalty);
                const heavyMultiplier = parseFloat(checkbox.dataset.heavyMultiplier);
                const easementMultiplier = parseFloat(checkbox.dataset.easementMultiplier);

                maxPenalty = Math.max(maxPenalty, penalty);
                maxHeavyMultiplier = Math.max(maxHeavyMultiplier, heavyMultiplier);
                maxEasementMultiplier = Math.max(maxEasementMultiplier, easementMultiplier);

                // Check for large pipes (>18 inches)
                if (diameter === 'large' || ['21', '24', '36', '48'].includes(diameter)) {
                    hasLargePipes = true;
                }
            }
        });

        return {
            penalty: maxPenalty,
            heavyMultiplier: maxHeavyMultiplier,
            easementMultiplier: maxEasementMultiplier,
            hasLargePipes
        };
    }

    calculateProduction(useRecycler = false) {
        const baseRate = parseFloat(this.baseRate.value) || 3100;
        const heavyPercent = parseFloat(this.heavyPercentage.value) / 100 || 0;
        const easementPercent = parseFloat(this.easementPercentage.value) / 100 || 0;
        const crewCount = parseFloat(this.crewCount.value) || 1;

        // Get pipe diameter info
        const pipeInfo = this.getPipeDiameterInfo();

        // Apply penalties with pipe-specific multipliers for heavy and easement
        const adjustedHeavyPenalty = this.heavyPenalty * pipeInfo.heavyMultiplier;
        const adjustedEasementPenalty = this.easementPenalty * pipeInfo.easementMultiplier;

        const heavyPenaltyFactor = 1 - (heavyPercent * adjustedHeavyPenalty);
        const easementPenaltyFactor = 1 - (easementPercent * adjustedEasementPenalty);
        const pipePenaltyFactor = 1 - pipeInfo.penalty;

        let production = baseRate * heavyPenaltyFactor * easementPenaltyFactor * pipePenaltyFactor;

        // Apply crew scaling (multiply by number of crews)
        production *= crewCount;

        // Apply recycler boost if enabled
        if (useRecycler && this.recyclerEnabled.checked) {
            const boostRange = parseFloat(this.boostRange.value) || 0.50;
            const realizationFactor = this.getRealizationFactor();
            const recyclerBoost = 1 + (boostRange * realizationFactor);
            production *= recyclerBoost;
        }

        return Math.round(production);
    }

    convertWorkDaysToCalendarDays(workDays) {
        const daysPerWeek = parseFloat(this.daysPerWeek.value) || 5;
        const fullWeeks = Math.floor(workDays / daysPerWeek);
        const remainingDays = workDays % daysPerWeek;
        return fullWeeks * 7 + remainingDays;
    }

    calculateLaborHours(workDays) {
        const hoursPerDay = parseFloat(this.hoursPerDay.value) || 8;
        const crewCount = parseFloat(this.crewCount.value) || 1;
        return workDays * hoursPerDay * crewCount;
    }

    calculate() {
        const totalFootage = parseFloat(this.totalFootage.value) || 0;

        if (totalFootage === 0) {
            this.clearResults();
            this.hideAllFlags();
            return;
        }

        // Calculate without recycler
        const prodWithout = this.calculateProduction(false);
        const daysWithout = Math.ceil(totalFootage / prodWithout);

        // Display without recycler results
        this.prodRateWithout.textContent = prodWithout.toLocaleString();
        this.daysWithout.textContent = daysWithout;

        // Calculate with recycler if enabled
        let daysWith = 0;
        if (this.recyclerEnabled.checked) {
            const prodWith = this.calculateProduction(true);
            daysWith = Math.ceil(totalFootage / prodWith);
            const savings = daysWithout - daysWith;

            this.prodRateWith.textContent = prodWith.toLocaleString();
            this.daysWith.textContent = daysWith;
            this.timeSavings.textContent = savings > 0 ? `${savings} days` : 'No savings';
            this.timeSavings.style.color = savings > 0 ? '#27ae60' : '#e74c3c';
        } else {
            this.prodRateWith.textContent = '-';
            this.daysWith.textContent = '-';
            this.timeSavings.textContent = '-';
            this.timeSavings.style.color = '#333';
        }

        // Check all flags and warnings
        this.checkScheduleOverrun(daysWithout, daysWith);
        this.checkLaborOverrun(daysWithout, daysWith);
        this.checkRecyclerSuggestion(daysWithout);
        this.checkHighRiskPipes();
    }

    hideAllFlags() {
        this.scheduleOverrunFlag.style.display = 'none';
        this.laborOverrunFlag.style.display = 'none';
        this.recyclerSuggestionFlag.style.display = 'none';
        this.highRiskFlag.style.display = 'none';
    }

    checkScheduleOverrun(daysWithout, daysWith) {
        const targetDays = parseFloat(this.targetDays.value);
        if (!targetDays) {
            this.scheduleOverrunFlag.style.display = 'none';
            return;
        }

        const currentDays = this.recyclerEnabled.checked ? daysWith : daysWithout;

        if (currentDays > targetDays) {
            const overrun = currentDays - targetDays;
            let suggestions = [];

            // Calculate what changes would help
            const crewCount = parseFloat(this.crewCount.value) || 1;
            const hoursPerDay = parseFloat(this.hoursPerDay.value) || 8;
            const daysPerWeek = parseFloat(this.daysPerWeek.value) || 5;

            // Suggest additional crews
            const neededCrews = Math.ceil(currentDays / targetDays);
            if (neededCrews > crewCount) {
                suggestions.push(`Add ${neededCrews - crewCount} more crew(s) (total: ${neededCrews})`);
            }

            // Suggest longer work days
            const neededHours = Math.ceil((currentDays / targetDays) * hoursPerDay);
            if (neededHours > hoursPerDay && neededHours <= 16) {
                suggestions.push(`Increase daily hours to ${neededHours} hours/day`);
            }

            // Suggest working weekends
            if (daysPerWeek < 7) {
                const neededDaysPerWeek = Math.ceil((currentDays / targetDays) * daysPerWeek);
                if (neededDaysPerWeek > daysPerWeek && neededDaysPerWeek <= 7) {
                    suggestions.push(`Work ${neededDaysPerWeek} days/week (including weekends)`);
                }
            }

            // Suggest recycler if not enabled
            if (!this.recyclerEnabled.checked && daysWith < currentDays) {
                suggestions.push(`Enable recycler (would reduce to ${daysWith} days)`);
            }

            this.scheduleOverrunFlag.style.display = 'block';
            this.scheduleOverrunText.textContent = `Project will take ${currentDays} days, exceeding target by ${overrun} days. Solutions: ${suggestions.join(' OR ')}.`;
        } else {
            this.scheduleOverrunFlag.style.display = 'none';
        }
    }

    checkLaborOverrun(daysWithout, daysWith) {
        const laborBudget = parseFloat(this.laborBudget.value);
        const laborOverageAllowed = parseFloat(this.laborOverageAllowed.value) || 10;

        if (!laborBudget) {
            this.laborOverrunFlag.style.display = 'none';
            return;
        }

        const currentDays = this.recyclerEnabled.checked ? daysWith : daysWithout;
        const estimatedLaborHours = this.calculateLaborHours(currentDays);
        const maxAllowedHours = laborBudget * (1 + laborOverageAllowed / 100);

        if (estimatedLaborHours > maxAllowedHours) {
            const overrun = estimatedLaborHours - maxAllowedHours;
            let suggestions = [];

            const crewCount = parseFloat(this.crewCount.value) || 1;
            const hoursPerDay = parseFloat(this.hoursPerDay.value) || 8;

            // Suggest increasing overage allowance
            const neededOverage = Math.ceil(((estimatedLaborHours / laborBudget) - 1) * 100);
            if (neededOverage > laborOverageAllowed) {
                suggestions.push(`Increase overage allowance to ${neededOverage}%`);
            }

            // Suggest reducing crew count (fewer crews work longer)
            if (crewCount > 1) {
                const reducedCrews = Math.max(1, crewCount - 1);
                const newLaborHours = this.calculateLaborHours(currentDays * (crewCount / reducedCrews));
                if (newLaborHours <= maxAllowedHours) {
                    suggestions.push(`Reduce to ${reducedCrews} crew(s) and extend timeline`);
                }
            }

            // Suggest reducing daily hours (work more days)
            if (hoursPerDay > 8) {
                const reducedHours = Math.max(8, hoursPerDay - 2);
                suggestions.push(`Reduce to ${reducedHours} hours/day (extends timeline)`);
            }

            // Suggest recycler if not enabled
            if (!this.recyclerEnabled.checked) {
                const recyclerLaborHours = this.calculateLaborHours(daysWith);
                if (recyclerLaborHours <= maxAllowedHours) {
                    suggestions.push(`Enable recycler (reduces to ${recyclerLaborHours} hours)`);
                }
            }

            this.laborOverrunFlag.style.display = 'block';
            this.laborOverrunText.textContent = `Estimated ${estimatedLaborHours} hours exceeds budget by ${Math.round(overrun)} hours. Solutions: ${suggestions.join(' OR ')}.`;
        } else {
            this.laborOverrunFlag.style.display = 'none';
        }
    }

    checkRecyclerSuggestion(daysWithout) {
        const targetDays = parseFloat(this.targetDays.value);
        const laborBudget = parseFloat(this.laborBudget.value);

        if (this.recyclerEnabled.checked) {
            this.recyclerSuggestionFlag.style.display = 'none';
            return;
        }

        // Calculate what would happen with recycler
        const prodWith = this.calculateProduction(true);
        const daysWith = Math.ceil((parseFloat(this.totalFootage.value) || 0) / prodWith);

        let shouldSuggest = false;
        let suggestionText = '';

        // Check if recycler would help meet schedule
        if (targetDays && daysWithout > targetDays && daysWith <= targetDays) {
            shouldSuggest = true;
            suggestionText = `Enabling the recycler would reduce project time to ${daysWith} days, meeting your ${targetDays}-day target.`;
        }

        // Check if recycler would help meet labor budget
        if (laborBudget && !shouldSuggest) {
            const laborOverageAllowed = parseFloat(this.laborOverageAllowed.value) || 10;
            const currentLaborHours = this.calculateLaborHours(daysWithout);
            const recyclerLaborHours = this.calculateLaborHours(daysWith);
            const maxAllowedHours = laborBudget * (1 + laborOverageAllowed / 100);

            if (currentLaborHours > maxAllowedHours && recyclerLaborHours <= maxAllowedHours) {
                shouldSuggest = true;
                suggestionText = `Enabling the recycler would reduce labor hours to ${recyclerLaborHours}, staying within your budget constraints.`;
            }
        }

        if (shouldSuggest) {
            this.recyclerSuggestionFlag.style.display = 'block';
            this.recyclerSuggestionText.textContent = suggestionText;
        } else {
            this.recyclerSuggestionFlag.style.display = 'none';
        }
    }

    checkHighRiskPipes() {
        const { hasLargePipes } = this.getPipeDiameterInfo();

        if (hasLargePipes) {
            this.highRiskFlag.style.display = 'block';
        } else {
            this.highRiskFlag.style.display = 'none';
        }
    }

    clearResults() {
        this.prodRateWithout.textContent = '-';
        this.daysWithout.textContent = '-';
        this.prodRateWith.textContent = '-';
        this.daysWith.textContent = '-';
        this.timeSavings.textContent = '-';
        this.hideAllFlags();
    }
}

// Initialize the calculator when the page loads
document.addEventListener('DOMContentLoaded', () => {
    new ProductionCalculator();
});

// Add tooltip functionality
document.addEventListener('DOMContentLoaded', () => {
    const tooltipElements = document.querySelectorAll('[data-tooltip]');
    
    tooltipElements.forEach(element => {
        element.addEventListener('mouseenter', (e) => {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = e.target.getAttribute('data-tooltip');
            document.body.appendChild(tooltip);
            
            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 5) + 'px';
        });
        
        element.addEventListener('mouseleave', () => {
            const tooltip = document.querySelector('.tooltip');
            if (tooltip) {
                tooltip.remove();
            }
        });
    });
});
    </script>
</body>
</html>