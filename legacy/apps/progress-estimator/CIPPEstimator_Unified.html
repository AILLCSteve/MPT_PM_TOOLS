<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIPP Production Estimator - MPT Tools</title>
    <style>
/* MPT CIPP Production Estimator - Unified Prep & Lining Calculator */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    line-height: 1.6;
    color: #ffffff;
    position: relative;
    min-height: 100vh;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('/shared/assets/images/bg1.jpg');
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    filter: brightness(0.75);
    z-index: -2;
}

body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(91, 127, 204, 0.4) 0%, rgba(30, 58, 138, 0.5) 100%);
    z-index: -1;
}

/* MPT Navbar */
.mpt-navbar {
    background: linear-gradient(135deg, #1E3A8A, #5B7FCC);
    padding: 15px 30px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.mpt-navbar .logo-container {
    display: flex;
    align-items: center;
    gap: 15px;
}

.mpt-navbar img {
    height: 40px;
    width: auto;
}

.mpt-navbar .app-title {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
}

.mpt-navbar .home-link {
    color: white;
    text-decoration: none;
    padding: 8px 20px;
    border: 2px solid white;
    border-radius: 5px;
    transition: all 0.3s;
    font-weight: 500;
}

.mpt-navbar .home-link:hover {
    background-color: white;
    color: #1E3A8A;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

header {
    text-align: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, rgba(30, 58, 138, 0.15), rgba(91, 127, 204, 0.15));
    backdrop-filter: blur(2.5px);
    color: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    font-weight: 700;
}

header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* Mode Selector */
.mode-selector {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(2.5px);
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
}

.mode-selector h2 {
    color: #ffffff;
    font-size: 1.8rem;
    margin-bottom: 20px;
    border-bottom: 3px solid #5B7FCC;
    padding-bottom: 10px;
}

.mode-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
}

.mode-btn {
    padding: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
    font-size: 1.1rem;
    font-weight: 600;
}

.mode-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: #5B7FCC;
    transform: translateY(-2px);
}

.mode-btn.active {
    background: linear-gradient(135deg, #5B7FCC, #1E3A8A);
    border-color: white;
    box-shadow: 0 4px 15px rgba(91, 127, 204, 0.5);
}

.mode-btn .mode-icon {
    font-size: 2em;
    display: block;
    margin-bottom: 10px;
}

.mode-btn .mode-description {
    font-size: 0.85rem;
    opacity: 0.9;
    font-weight: 400;
    margin-top: 5px;
}

/* Sections */
.section-container {
    display: none;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.section-container.active {
    display: grid;
}

.input-section, .results-section {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(2.5px);
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

h2 {
    color: #ffffff;
    font-size: 1.8rem;
    margin-bottom: 20px;
    border-bottom: 3px solid #5B7FCC;
    padding-bottom: 10px;
}

h3 {
    color: #ffffff;
    font-size: 1.4rem;
    margin: 20px 0 15px 0;
}

h4 {
    color: #ffffff;
    font-size: 1.2rem;
    margin: 15px 0 10px 0;
}

.input-group {
    margin-bottom: 20px;
}

.input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #ffffff;
}

.slider-container {
    display: flex;
    align-items: center;
    gap: 15px;
}

.slider {
    flex: 1;
    height: 6px;
    border-radius: 3px;
    background: #ddd;
    outline: none;
    transition: background 0.3s;
}

.slider::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #5B7FCC;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #5B7FCC;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.number-input {
    width: 100px;
    padding: 8px 12px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    text-align: center;
    transition: border-color 0.3s;
}

.number-input:focus {
    outline: none;
    border-color: #5B7FCC;
}

input[type="number"] {
    width: 150px;
    padding: 12px 15px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    transition: border-color 0.3s;
}

input[type="number"]:focus {
    outline: none;
    border-color: #5B7FCC;
}

.unit {
    font-weight: 600;
    color: #ffffff;
    min-width: 30px;
}

/* Penalty/Boost Adjusters */
.penalty-adjuster {
    background: rgba(248, 249, 250, 0.9);
    backdrop-filter: blur(5px);
    padding: 15px;
    border-radius: 8px;
    border: 2px solid rgba(233, 236, 239, 0.9);
    margin-top: 10px;
    color: #333;
}

.penalty-adjuster h5 {
    color: #1E3A8A;
    font-size: 1rem;
    margin-bottom: 10px;
}

.adjuster-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.adjuster-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.adjuster-item label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
}

/* Results */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
}

th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    color: #333;
}

th {
    background: #f8f9fa;
    font-weight: 600;
    color: #1E3A8A;
}

tr:nth-child(even) {
    background: #f8f9fa;
}

.highlight-row {
    background: #DBEAFE !important;
    border-left: 4px solid #5B7FCC;
    font-weight: 600;
}

.unified-results {
    grid-column: 1 / -1;
}

/* Responsive */
@media (max-width: 1024px) {
    .section-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    body::before {
        background-attachment: scroll;
    }

    .mpt-navbar {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
    }

    header h1 {
        font-size: 2rem;
    }

    .adjuster-grid {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <!-- MPT Navigation Bar -->
    <nav class="mpt-navbar">
        <div class="logo-container">
            <img src="/shared/assets/images/logo.png" alt="Municipal Pipe Tool">
            <span class="app-title">CIPP Production Estimator</span>
        </div>
        <a href="/" class="home-link">‚Üê Home</a>
    </nav>

    <div class="container">
        <header>
            <h1>üèóÔ∏è CIPP Production Estimator</h1>
            <p>Comprehensive calculator for CIPP Prep (Cleaning/CCTV) and Lining production with fleet management</p>
        </header>

        <!-- Mode Selector -->
        <div class="mode-selector">
            <h2>üìã Select Estimation Mode</h2>
            <div class="mode-buttons">
                <div class="mode-btn" id="modePrepOnly" onclick="setMode('prep')">
                    <span class="mode-icon">üöø</span>
                    <div>CIPP Prep Only</div>
                    <div class="mode-description">Sewer Cleaning & CCTV Inspection</div>
                </div>
                <div class="mode-btn" id="modeLiningOnly" onclick="setMode('lining')">
                    <span class="mode-icon">üîß</span>
                    <div>CIPP Lining Only</div>
                    <div class="mode-description">Pipe Lining Installation & Curing</div>
                </div>
                <div class="mode-btn active" id="modeUnified" onclick="setMode('unified')">
                    <span class="mode-icon">üéØ</span>
                    <div>Unified (Prep + Lining)</div>
                    <div class="mode-description">Complete CIPP Rehabilitation Project</div>
                </div>
            </div>
        </div>

        <!-- CIPP PREP SECTION -->
        <div class="section-container active" id="prepSection">
            <div class="input-section">
                <h2>üöø CIPP Prep (Cleaning/CCTV)</h2>

                <div class="input-group">
                    <label for="prepFootage">Total Footage to Clean/TV:</label>
                    <input type="number" id="prepFootage" placeholder="198000" min="0">
                    <span class="unit">ft</span>
                </div>

                <div class="input-group">
                    <label for="prepBaseRate">Base Production Rate:</label>
                    <div class="slider-container">
                        <input type="range" id="prepBaseRateSlider" min="2000" max="5000" step="50" value="3100" class="slider">
                        <input type="number" id="prepBaseRate" min="2000" max="5000" step="50" value="3100" class="number-input">
                        <span class="unit">ft/day</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="prepCrews">Number of Prep Crews:</label>
                    <input type="number" id="prepCrews" min="1" max="10" value="2">
                    <span class="unit">crews</span>
                </div>

                <h3>‚öôÔ∏è Adjustable Penalties</h3>
                <div class="penalty-adjuster">
                    <h5>Customize Penalty Factors (0 = no penalty, 1 = 100% penalty)</h5>
                    <div class="adjuster-grid">
                        <div class="adjuster-item">
                            <label>Heavy Cleaning Penalty:</label>
                            <div class="slider-container">
                                <input type="range" id="prepHeavyPenaltySlider" min="0" max="1" step="0.05" value="0.40" class="slider">
                                <input type="number" id="prepHeavyPenalty" min="0" max="1" step="0.05" value="0.40" class="number-input">
                            </div>
                        </div>
                        <div class="adjuster-item">
                            <label>Easement Work Penalty:</label>
                            <div class="slider-container">
                                <input type="range" id="prepEasementPenaltySlider" min="0" max="1" step="0.05" value="0.30" class="slider">
                                <input type="number" id="prepEasementPenalty" min="0" max="1" step="0.05" value="0.30" class="number-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="prepHeavyPercent">Heavy Cleaning %:</label>
                    <div class="slider-container">
                        <input type="range" id="prepHeavySlider" min="0" max="100" value="0" class="slider">
                        <input type="number" id="prepHeavyPercent" min="0" max="100" value="0" class="number-input">
                        <span class="unit">%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="prepEasementPercent">Easement Work %:</label>
                    <div class="slider-container">
                        <input type="range" id="prepEasementSlider" min="0" max="100" value="0" class="slider">
                        <input type="number" id="prepEasementPercent" min="0" max="100" value="0" class="number-input">
                        <span class="unit">%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>
                        <input type="checkbox" id="prepRecyclerEnabled">
                        Use Recycler (Boost Production)
                    </label>
                </div>
            </div>

            <div class="results-section">
                <h2>üìä Prep Results</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Effective Production Rate</td>
                            <td id="prepProdRate">-</td>
                        </tr>
                        <tr>
                            <td>Total Work Days Required</td>
                            <td id="prepDays">-</td>
                        </tr>
                        <tr class="highlight-row">
                            <td><strong>Calendar Days (including weekends)</strong></td>
                            <td id="prepCalendarDays"><strong>-</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- CIPP LINING SECTION -->
        <div class="section-container active" id="liningSection">
            <div class="input-section">
                <h2>üîß CIPP Lining Installation</h2>

                <div class="input-group">
                    <label for="liningFootage">Total Footage to Line:</label>
                    <input type="number" id="liningFootage" placeholder="198000" min="0">
                    <span class="unit">ft</span>
                </div>

                <div class="input-group">
                    <label for="liningBaseRate">Base Production Rate:</label>
                    <div class="slider-container">
                        <input type="range" id="liningBaseRateSlider" min="1500" max="4000" step="50" value="2500" class="slider">
                        <input type="number" id="liningBaseRate" min="1500" max="4000" step="50" value="2500" class="number-input">
                        <span class="unit">ft/week</span>
                    </div>
                    <small style="color: rgba(255,255,255,0.8); display: block; margin-top: 5px;">Average per crew: 2000-3000 ft/week | Range: 300-5000 ft/week</small>
                </div>

                <div class="input-group">
                    <label for="liningCrews">Number of Lining Crews:</label>
                    <input type="number" id="liningCrews" min="1" max="10" value="3">
                    <span class="unit">crews</span>
                </div>

                <h3>üå°Ô∏è Environmental Factors</h3>
                <div class="penalty-adjuster">
                    <h5>Customize Environmental Penalty Factors</h5>
                    <div class="adjuster-grid">
                        <div class="adjuster-item">
                            <label>Cold Weather Penalty (< 50¬∞F):</label>
                            <div class="slider-container">
                                <input type="range" id="coldWeatherPenaltySlider" min="0" max="0.5" step="0.05" value="0.30" class="slider">
                                <input type="number" id="coldWeatherPenalty" min="0" max="0.5" step="0.05" value="0.30" class="number-input">
                            </div>
                        </div>
                        <div class="adjuster-item">
                            <label>Hot Weather Penalty (> 85¬∞F):</label>
                            <div class="slider-container">
                                <input type="range" id="hotWeatherPenaltySlider" min="0" max="0.3" step="0.05" value="0.20" class="slider">
                                <input type="number" id="hotWeatherPenalty" min="0" max="0.3" step="0.05" value="0.20" class="number-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Weather Conditions:</label>
                    <select id="weatherCondition" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #ddd;">
                        <option value="optimal">Optimal (50-85¬∞F)</option>
                        <option value="cold">Cold (< 50¬∞F)</option>
                        <option value="hot">Hot (> 85¬∞F)</option>
                    </select>
                </div>

                <h3>üéØ Crew & Equipment Factors</h3>
                <div class="penalty-adjuster">
                    <h5>Customize Crew/Equipment Factors</h5>
                    <div class="adjuster-grid">
                        <div class="adjuster-item">
                            <label>New Crew Penalty:</label>
                            <div class="slider-container">
                                <input type="range" id="newCrewPenaltySlider" min="0" max="0.5" step="0.05" value="0.30" class="slider">
                                <input type="number" id="newCrewPenalty" min="0" max="0.5" step="0.05" value="0.30" class="number-input">
                            </div>
                        </div>
                        <div class="adjuster-item">
                            <label>Equipment Issues Penalty:</label>
                            <div class="slider-container">
                                <input type="range" id="equipmentPenaltySlider" min="0" max="0.6" step="0.05" value="0.40" class="slider">
                                <input type="number" id="equipmentPenalty" min="0" max="0.6" step="0.05" value="0.40" class="number-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Crew Experience:</label>
                    <select id="crewExperience" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #ddd;">
                        <option value="experienced">Experienced (2+ years)</option>
                        <option value="new">New (< 6 months)</option>
                        <option value="mixed">Mixed Experience</option>
                    </select>
                </div>

                <h3>‚ö° Curing Method (Boost)</h3>
                <div class="penalty-adjuster">
                    <h5>Customize Curing Method Boost Factors</h5>
                    <div class="adjuster-grid">
                        <div class="adjuster-item">
                            <label>Steam Curing Boost:</label>
                            <div class="slider-container">
                                <input type="range" id="steamBoostSlider" min="0" max="0.3" step="0.05" value="0.15" class="slider">
                                <input type="number" id="steamBoost" min="0" max="0.3" step="0.05" value="0.15" class="number-input">
                            </div>
                        </div>
                        <div class="adjuster-item">
                            <label>UV Curing Boost:</label>
                            <div class="slider-container">
                                <input type="range" id="uvBoostSlider" min="0" max="0.6" step="0.05" value="0.40" class="slider">
                                <input type="number" id="uvBoost" min="0" max="0.6" step="0.05" value="0.40" class="number-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Curing Method:</label>
                    <select id="curingMethod" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #ddd;">
                        <option value="water">Hot Water (baseline)</option>
                        <option value="steam">Steam (+15% faster)</option>
                        <option value="uv">UV Light (+40% faster)</option>
                    </select>
                </div>

                <h3>üèóÔ∏è Pipe Diameter Penalties</h3>
                <div class="penalty-adjuster">
                    <h5>Customize Diameter-Specific Penalties</h5>
                    <div class="adjuster-grid">
                        <div class="adjuster-item">
                            <label>15-18" Pipe Penalty:</label>
                            <div class="slider-container">
                                <input type="range" id="largePipePenaltySlider" min="0" max="0.4" step="0.05" value="0.20" class="slider">
                                <input type="number" id="largePipePenalty" min="0" max="0.4" step="0.05" value="0.20" class="number-input">
                            </div>
                        </div>
                        <div class="adjuster-item">
                            <label>21"+ Pipe Penalty:</label>
                            <div class="slider-container">
                                <input type="range" id="veryLargePipePenaltySlider" min="0" max="0.6" step="0.05" value="0.40" class="slider">
                                <input type="number" id="veryLargePipePenalty" min="0" max="0.6" step="0.05" value="0.40" class="number-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Average Pipe Diameter:</label>
                    <select id="pipeDiameter" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #ddd;">
                        <option value="small">6-12" (standard rate)</option>
                        <option value="medium">15-18" (-20%)</option>
                        <option value="large">21"+ (-40%)</option>
                    </select>
                </div>
            </div>

            <div class="results-section">
                <h2>üìä Lining Results</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Effective Production Rate</td>
                            <td id="liningProdRate">-</td>
                        </tr>
                        <tr>
                            <td>Total Weeks Required</td>
                            <td id="liningWeeks">-</td>
                        </tr>
                        <tr class="highlight-row">
                            <td><strong>Calendar Days</strong></td>
                            <td id="liningDays"><strong>-</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- UNIFIED RESULTS -->
        <div class="unified-results" id="unifiedResults" style="display: none;">
            <div class="input-section" style="grid-column: 1 / -1;">
                <h2>üéØ Unified Project Timeline</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Phase</th>
                            <th>Duration</th>
                            <th>Production Rate</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Phase 1: CIPP Prep</strong></td>
                            <td id="unifiedPrepDays">-</td>
                            <td id="unifiedPrepRate">-</td>
                            <td>Must complete before lining</td>
                        </tr>
                        <tr>
                            <td><strong>Phase 2: CIPP Lining</strong></td>
                            <td id="unifiedLiningDays">-</td>
                            <td id="unifiedLiningRate">-</td>
                            <td>Starts after prep completion</td>
                        </tr>
                        <tr class="highlight-row">
                            <td><strong>TOTAL PROJECT DURATION</strong></td>
                            <td id="unifiedTotalDays"><strong>-</strong></td>
                            <td colspan="2"><strong>Sequential phases (no overlap)</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
// ============================================================================
// CIPP UNIFIED ESTIMATOR - Three Modes: Prep Only, Lining Only, Unified
// ============================================================================

let currentMode = 'unified';

// Set estimation mode
function setMode(mode) {
    currentMode = mode;

    // Update button states
    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`mode${mode.charAt(0).toUpperCase() + mode.slice(1)}${mode === 'unified' ? '' : 'Only'}`).classList.add('active');

    // Show/hide sections
    const prepSection = document.getElementById('prepSection');
    const liningSection = document.getElementById('liningSection');
    const unifiedResults = document.getElementById('unifiedResults');

    if (mode === 'prep') {
        prepSection.classList.add('active');
        liningSection.classList.remove('active');
        unifiedResults.style.display = 'none';
    } else if (mode === 'lining') {
        prepSection.classList.remove('active');
        liningSection.classList.add('active');
        unifiedResults.style.display = 'none';
    } else { // unified
        prepSection.classList.add('active');
        liningSection.classList.add('active');
        unifiedResults.style.display = 'block';
    }

    // Recalculate
    calculate();
}

// Sync sliders with number inputs
function syncSlider(sliderId, inputId) {
    const slider = document.getElementById(sliderId);
    const input = document.getElementById(inputId);

    slider.addEventListener('input', () => {
        input.value = slider.value;
        calculate();
    });

    input.addEventListener('input', () => {
        slider.value = input.value;
        calculate();
    });
}

// Initialize all slider syncs
document.addEventListener('DOMContentLoaded', () => {
    // Prep sliders
    syncSlider('prepBaseRateSlider', 'prepBaseRate');
    syncSlider('prepHeavySlider', 'prepHeavyPercent');
    syncSlider('prepEasementSlider', 'prepEasementPercent');
    syncSlider('prepHeavyPenaltySlider', 'prepHeavyPenalty');
    syncSlider('prepEasementPenaltySlider', 'prepEasementPenalty');

    // Lining sliders
    syncSlider('liningBaseRateSlider', 'liningBaseRate');
    syncSlider('coldWeatherPenaltySlider', 'coldWeatherPenalty');
    syncSlider('hotWeatherPenaltySlider', 'hotWeatherPenalty');
    syncSlider('newCrewPenaltySlider', 'newCrewPenalty');
    syncSlider('equipmentPenaltySlider', 'equipmentPenalty');
    syncSlider('steamBoostSlider', 'steamBoost');
    syncSlider('uvBoostSlider', 'uvBoost');
    syncSlider('largePipePenaltySlider', 'largePipePenalty');
    syncSlider('veryLargePipePenaltySlider', 'veryLargePipePenalty');

    // Add input listeners
    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('change', calculate);
        el.addEventListener('input', calculate);
    });

    // Initial calculation
    calculate();
});

// Calculate prep production
function calculatePrep() {
    const footage = parseFloat(document.getElementById('prepFootage').value) || 0;
    if (footage === 0) return null;

    const baseRate = parseFloat(document.getElementById('prepBaseRate').value) || 3100;
    const crews = parseFloat(document.getElementById('prepCrews').value) || 2;
    const heavyPercent = parseFloat(document.getElementById('prepHeavyPercent').value) / 100 || 0;
    const easementPercent = parseFloat(document.getElementById('prepEasementPercent').value) / 100 || 0;
    const heavyPenalty = parseFloat(document.getElementById('prepHeavyPenalty').value) || 0.40;
    const easementPenalty = parseFloat(document.getElementById('prepEasementPenalty').value) || 0.30;
    const recyclerEnabled = document.getElementById('prepRecyclerEnabled').checked;

    // Calculate effective rate
    let effectiveRate = baseRate * (1 - heavyPercent * heavyPenalty) * (1 - easementPercent * easementPenalty);
    effectiveRate *= crews;

    if (recyclerEnabled) {
        effectiveRate *= 1.25; // 25% boost from recycler
    }

    const workDays = Math.ceil(footage / effectiveRate);
    const calendarDays = Math.ceil(workDays * 7 / 5); // Assume 5-day work week

    return {
        rate: Math.round(effectiveRate),
        workDays: workDays,
        calendarDays: calendarDays
    };
}

// Calculate lining production
function calculateLining() {
    const footage = parseFloat(document.getElementById('liningFootage').value) || 0;
    if (footage === 0) return null;

    const baseRatePerWeek = parseFloat(document.getElementById('liningBaseRate').value) || 2500;
    const crews = parseFloat(document.getElementById('liningCrews').value) || 3;
    const weather = document.getElementById('weatherCondition').value;
    const crewExp = document.getElementById('crewExperience').value;
    const curing = document.getElementById('curingMethod').value;
    const diameter = document.getElementById('pipeDiameter').value;

    // Get user-adjustable penalties
    const coldPenalty = parseFloat(document.getElementById('coldWeatherPenalty').value) || 0.30;
    const hotPenalty = parseFloat(document.getElementById('hotWeatherPenalty').value) || 0.20;
    const newCrewPenalty = parseFloat(document.getElementById('newCrewPenalty').value) || 0.30;
    const equipmentPenalty = parseFloat(document.getElementById('equipmentPenalty').value) || 0.40;
    const steamBoost = parseFloat(document.getElementById('steamBoost').value) || 0.15;
    const uvBoost = parseFloat(document.getElementById('uvBoost').value) || 0.40;
    const largePipePenalty = parseFloat(document.getElementById('largePipePenalty').value) || 0.20;
    const veryLargePipePenalty = parseFloat(document.getElementById('veryLargePipePenalty').value) || 0.40;

    // Start with base rate per crew
    let effectiveRate = baseRatePerWeek;

    // Apply weather penalties
    if (weather === 'cold') {
        effectiveRate *= (1 - coldPenalty);
    } else if (weather === 'hot') {
        effectiveRate *= (1 - hotPenalty);
    }

    // Apply crew experience
    if (crewExp === 'new') {
        effectiveRate *= (1 - newCrewPenalty);
    } else if (crewExp === 'mixed') {
        effectiveRate *= (1 - newCrewPenalty * 0.5);
    }

    // Apply pipe diameter penalties
    if (diameter === 'medium') {
        effectiveRate *= (1 - largePipePenalty);
    } else if (diameter === 'large') {
        effectiveRate *= (1 - veryLargePipePenalty);
    }

    // Apply curing method boosts
    if (curing === 'steam') {
        effectiveRate *= (1 + steamBoost);
    } else if (curing === 'uv') {
        effectiveRate *= (1 + uvBoost);
    }

    // Multiply by number of crews
    effectiveRate *= crews;

    const weeksRequired = Math.ceil(footage / effectiveRate);
    const daysRequired = weeksRequired * 7;

    return {
        rate: Math.round(effectiveRate),
        weeks: weeksRequired,
        days: daysRequired
    };
}

// Main calculation function
function calculate() {
    if (currentMode === 'prep' || currentMode === 'unified') {
        const prepResults = calculatePrep();
        if (prepResults) {
            document.getElementById('prepProdRate').textContent = `${prepResults.rate.toLocaleString()} ft/day`;
            document.getElementById('prepDays').textContent = `${prepResults.workDays} work days`;
            document.getElementById('prepCalendarDays').textContent = `${prepResults.calendarDays} calendar days`;
        } else {
            document.getElementById('prepProdRate').textContent = '-';
            document.getElementById('prepDays').textContent = '-';
            document.getElementById('prepCalendarDays').textContent = '-';
        }
    }

    if (currentMode === 'lining' || currentMode === 'unified') {
        const liningResults = calculateLining();
        if (liningResults) {
            document.getElementById('liningProdRate').textContent = `${liningResults.rate.toLocaleString()} ft/week`;
            document.getElementById('liningWeeks').textContent = `${liningResults.weeks} weeks`;
            document.getElementById('liningDays').textContent = `${liningResults.days} days`;
        } else {
            document.getElementById('liningProdRate').textContent = '-';
            document.getElementById('liningWeeks').textContent = '-';
            document.getElementById('liningDays').textContent = '-';
        }
    }

    // Unified results
    if (currentMode === 'unified') {
        const prepResults = calculatePrep();
        const liningResults = calculateLining();

        if (prepResults && liningResults) {
            document.getElementById('unifiedPrepDays').textContent = `${prepResults.calendarDays} days`;
            document.getElementById('unifiedPrepRate').textContent = `${prepResults.rate.toLocaleString()} ft/day`;
            document.getElementById('unifiedLiningDays').textContent = `${liningResults.days} days`;
            document.getElementById('unifiedLiningRate').textContent = `${liningResults.rate.toLocaleString()} ft/week`;

            const totalDays = prepResults.calendarDays + liningResults.days;
            document.getElementById('unifiedTotalDays').textContent = `${totalDays} days (${Math.ceil(totalDays / 7)} weeks)`;
        }
    }
}
    </script>
</body>
</html>